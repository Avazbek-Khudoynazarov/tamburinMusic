import{ah as H,r,R as J,bi as g,Y as k,D as s,V as f,a6 as h,F as o,T as D,W as P,ak as Z,Z as X}from"./index-DJm73Gd8.js";import{z as l}from"./index-DXqQCM1T.js";import{t as $,F as K}from"./form-provider-Bv2QLm_X.js";import{u as Y,F as t}from"./fields-DRFNYTBH.js";import{M as q}from"./ko-DBbRYMOz.js";import"./image-DPed605N.js";import{I as Q}from"./InstrumentService-CF3tqggI.js";import{C as w}from"./CurriculumService-BheEP2wv.js";import{C as G}from"./Card-DCic7xzO.js";import{C as L}from"./CardHeader-qrX2o-AK.js";import{L as E}from"./LoadingButton-8OnUjDzw.js";const V=l.object({instrument_id:l.number(),months:l.number(),weekly_classes:l.number(),total_classes:l.number(),name:l.string().min(2,{message:"커리큘럼명을 입력해 주세요"}),price:l.number(),instrument_price:l.number(),instrument_rental_fee:l.number(),instrument_discount:l.number(),image_file:l.string(),additional_text:l.string(),text1:l.string(),text2:l.string(),text3:l.string(),is_deleted:l.string(),created_date:l.date(),instrument:l.object({id:l.number().optional(),name:l.string().optional(),image_file1:l.string().optional(),image_file2:l.string().optional(),display_order:l.number().optional(),is_deleted:l.string().optional(),created_date:l.date().optional()})}),I=V.extend({id:l.number()});function me({currentItem:e}){var T;const u=H(),j=r.useMemo(()=>{let a={text1:"",text2:"",text3:""};if(e!=null&&e.additional_text&&e.additional_text.startsWith("{")&&e.additional_text.endsWith("}"))try{a=JSON.parse(e.additional_text)}catch(i){console.error("Failed to parse additional_text:",i)}return{id:(e==null?void 0:e.id)||0,instrument_id:(e==null?void 0:e.instrument_id)||0,months:(e==null?void 0:e.months)||0,weekly_classes:(e==null?void 0:e.weekly_classes)||1,total_classes:(e==null?void 0:e.total_classes)||1,name:(e==null?void 0:e.name)||"",price:(e==null?void 0:e.price)||0,instrument_price:(e==null?void 0:e.instrument_price)||0,instrument_rental_fee:(e==null?void 0:e.instrument_rental_fee)||0,instrument_discount:(e==null?void 0:e.instrument_discount)||0,image_file:(e==null?void 0:e.image_file)||"",additional_text:(e==null?void 0:e.additional_text)||"",text1:a.text1||"",text2:a.text2||"",text3:a.text3||"",is_deleted:(e==null?void 0:e.is_deleted)||"N",created_date:e!=null&&e.created_date?new Date(e.created_date):new Date,instrument:(e==null?void 0:e.instrument)||{id:0,name:"",image_file1:"",image_file2:"",display_order:0,is_deleted:"N",created_date:new Date}}},[e]),R=r.useMemo(()=>e?I:V,[e]),d=Y({mode:"onSubmit",resolver:$(R),defaultValues:j}),{setValue:ee,reset:b,watch:M,control:se,handleSubmit:W,formState:{isSubmitting:ae}}=d;r.useEffect(()=>{e&&b(j)},[e,j,b]);const p=M(),[B,O]=r.useState([]),C=r.useCallback(async()=>{const a=await Q.getAllList();a&&O(a)},[]);r.useEffect(()=>{C()},[C]);const[n,y]=r.useState({1:null});r.useEffect(()=>{e&&y({1:e.image_file||null})},[e]);const[z,S]=r.useState({1:"선택된 파일 없음",2:"선택된 파일 없음",3:"선택된 파일 없음"}),U=async(a,i)=>{var m;const x=(m=i.target.files)==null?void 0:m[0];if(x){if(x.size>5242880){alert("파일 크기는 5MB 이하여야 합니다.");return}y(_=>({..._,[a]:x})),S(_=>({..._,[a]:x.name}))}},A=W(async a=>{try{const i={};try{const c=Object.entries(n).filter(([_,v])=>v instanceof File).map(async([_,v])=>{const F=new FormData;F.append("file",v);const N=await w.addAttachment(F);N.filename&&(i[Number(_)]=`${J.serverUrl}/${N.path.replace(/\\/g,"/")}`)});await Promise.all(c),a.image_file=i[1]||(typeof n[1]=="string"?n[1]:"")}catch(c){console.error("파일 업로드 에러:",c),alert("파일 업로드에 실패했습니다.");return}const x=JSON.stringify({text1:a.text1,text2:a.text2,text3:a.text3}),m={id:e==null?void 0:e.id,instrument_id:a.instrument_id,months:a.months,weekly_classes:a.weekly_classes,total_classes:a.total_classes,name:a.name,price:a.price,instrument_price:a.instrument_price,instrument_rental_fee:a.instrument_rental_fee,instrument_discount:a.instrument_discount,image_file:a.image_file,additional_text:x,is_deleted:a.is_deleted||"N",created_date:a.created_date||new Date};e?await w.update(m)==="success"?(g.success("커리큘럼 정보가 수정되었습니다."),u.push(k.curriculum.list)):g.error("커리큘럼 수정에 실패했습니다."):await w.create(m)?(g.success("커리큘럼 정보가 등록되었습니다."),u.push(k.curriculum.list)):g.error("커리큘럼 등록에 실패했습니다."),b()}catch(i){console.error(i),g.error("오류가 발생했습니다. 다시 시도해주세요.")}});return s.jsx(K,{methods:d,onSubmit:A,children:s.jsxs(f,{spacing:{xs:3,md:5},sx:{mt:3,mx:"auto",maxWidth:{xs:720,xl:1200}},children:[s.jsxs(G,{children:[s.jsx(L,{title:"기본 정보",subheader:"",sx:{mb:1}}),s.jsx(h,{}),s.jsxs(f,{spacing:3,sx:{p:3},children:[s.jsxs(o,{rowGap:3,columnGap:2,display:"grid",gridTemplateColumns:{xs:"repeat(1, 1fr)",sm:"repeat(2, 1fr)"},children:[s.jsx(t.Select,{name:"instrument_id",size:"medium",label:"악기",InputLabelProps:{shrink:!0},children:B.map(a=>s.jsx(q,{value:a.id,children:a.name},a.id))}),s.jsx(t.Text,{name:"name",label:"커리큘럼명"}),s.jsx(t.Text,{name:"price",label:"금액",onChange:a=>{const i=a.target.value.replace(/[^0-9]/g,"");d.setValue("price",i?Number(i):0)},value:p.price})]}),s.jsx(h,{}),s.jsxs(o,{rowGap:3,columnGap:2,display:"grid",gridTemplateColumns:{xs:"repeat(1, 1fr)",sm:"repeat(2, 1fr)"},children:[s.jsx(t.Text,{name:"instrument_price",label:"악기구입비",onChange:a=>{const i=a.target.value.replace(/[^0-9]/g,"");d.setValue("instrument_price",i?Number(i):0)},value:p.instrument_price}),s.jsx(t.Text,{name:"instrument_rental_fee",label:"악기대여비",onChange:a=>{const i=a.target.value.replace(/[^0-9]/g,"");d.setValue("instrument_rental_fee",i?Number(i):0)},value:p.instrument_rental_fee}),s.jsx(t.Text,{name:"instrument_discount",label:"악기보유 시 할인금액",onChange:a=>{const i=a.target.value.replace(/[^0-9]/g,"");d.setValue("instrument_discount",i?Number(i):0)},value:p.instrument_discount})]}),s.jsx(h,{}),s.jsxs(o,{rowGap:3,columnGap:2,display:"grid",gridTemplateColumns:{xs:"repeat(1, 1fr)",sm:"repeat(2, 1fr)"},children:[s.jsx(t.Text,{name:"months",label:"개월 수",onChange:a=>{const i=a.target.value.replace(/[^0-9]/g,"");d.setValue("months",i?Number(i):0)},value:p.months}),s.jsx(t.Text,{name:"weekly_classes",label:"주별 수업횟수",onChange:a=>{const i=a.target.value.replace(/[^0-9]/g,"");d.setValue("weekly_classes",i?Number(i):0)},value:p.weekly_classes}),s.jsx(t.Text,{name:"total_classes",label:"수업횟수",onChange:a=>{const i=a.target.value.replace(/[^0-9]/g,"");d.setValue("total_classes",i?Number(i):0)},value:p.total_classes}),s.jsx("br",{}),s.jsxs(o,{sx:{pl:"14px"},children:[s.jsx(D,{variant:"subtitle2",children:"썸네일"}),s.jsx("br",{}),s.jsxs(o,{children:[s.jsx("input",{type:"file",id:"file1",style:{display:"none"},onChange:a=>{var x;((x=a.target.files)==null?void 0:x[0])&&U(1,a)}},n[1]?"hasFile":"noFile"),typeof n[1]=="string"?s.jsx(o,{sx:{mb:2},children:s.jsx("img",{src:n[1],alt:"이미지",style:{maxWidth:"200px",maxHeight:"200px"}})}):n[1]?(T=n[1])!=null&&T.type.startsWith("image/")?s.jsx(o,{sx:{mb:2},children:s.jsx("img",{src:URL.createObjectURL(n[1]),alt:"이미지",style:{maxWidth:"200px",maxHeight:"200px"}})}):s.jsx(o,{sx:{mb:2},children:s.jsxs("a",{href:URL.createObjectURL(n[1]),download:!0,children:["다운로드 [",n[1].name,"]"]})}):null,s.jsxs(f,{spacing:2,direction:"row",alignItems:"center",children:[s.jsx(P,{variant:"contained",component:"label",htmlFor:"file1",children:"파일 선택"}),s.jsx(D,{sx:{flex:1},children:z[1]}),n[1]&&s.jsx(Z,{onClick:()=>{const a=document.getElementById("file1");a&&(a.value=""),y(i=>({...i,1:null})),S(i=>({...i,1:"선택된 파일 없음"}))},children:s.jsx(X,{icon:"mdi:delete"})})]})]})]})]})]})]}),s.jsxs(G,{children:[s.jsx(L,{title:"추가 정보",subheader:"",sx:{mb:1}}),s.jsx(h,{}),s.jsxs(f,{spacing:3,sx:{p:3},children:[s.jsxs(o,{rowGap:3,columnGap:2,display:"grid",gridTemplateColumns:{xs:"repeat(1, 1fr)",sm:"repeat(2, 1fr)"},children:[s.jsx(t.Text,{name:"text1",label:"악기노출문구"}),s.jsx(t.Text,{name:"text2",label:"노출문구"}),s.jsx(t.Text,{name:"text3",label:"할인률"})]}),s.jsx(h,{}),s.jsx(o,{rowGap:3,columnGap:2,display:"grid",gridTemplateColumns:{xs:"repeat(1, 1fr)",sm:"repeat(2, 1fr)"},children:s.jsx(t.Text,{name:"created_date",label:"생성일",value:e!=null&&e.created_date?new Date(e.created_date).toLocaleDateString("ko-KR",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}):"",disabled:!0})})]})]}),s.jsxs(f,{direction:"row",alignItems:"flex-end",justifyContent:"flex-end",sx:{mt:3,gap:"10px"},children:[s.jsx(E,{color:"inherit",size:"large",variant:"outlined",onClick:()=>u.back(),children:"목록으로"}),s.jsx(E,{type:"submit",variant:"contained",size:"large",children:e?"수정 완료":"등록 완료"})]})]})})}export{me as N};
