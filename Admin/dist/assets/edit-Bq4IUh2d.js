import{cA as h,R as x,ah as N,r as f,D as e,V as y,a6 as A,F as m,T as $,W as S,ak as D,Z as b,bi as _,bj as L}from"./index-DJm73Gd8.js";import{u as z}from"./use-tabs-B1gcKklP.js";import{C as O}from"./custom-breadcrumbs-BsaNbwZB.js";import{A as c}from"./AuthService-foVeZrRB.js";import{C as R}from"./Card-DCic7xzO.js";import{C as U}from"./CardHeader-qrX2o-AK.js";import{T as w}from"./TextField-B_joUv90.js";import{L as W}from"./LoadingButton-8OnUjDzw.js";import{T as J,a as M}from"./Tabs-BcQ-S5hI.js";import"./ListContext-CDIiNrC7.js";import"./KeyboardArrowRight-S08dGk5c.js";const j={async getByEntityType(i){try{return(await h.get(`${x.serverUrl}/manage/banner/list/all?entity_type=${i}`,{headers:{Authorization:`Bearer ${c.getToken()}`}})).data}catch{c.clearLocalCredential(),window.location.replace("/");return}},async deleteByEntityType(i){try{return(await h.delete(`${x.serverUrl}/manage/banner/deleteByEntityType?entity_type=${i}`,{headers:{Authorization:`Bearer ${c.getToken()}`}})).data}catch{c.clearLocalCredential(),window.location.replace("/");return}},async createRows(i){try{return(await h.post(`${x.serverUrl}/manage/banner/createRows`,{banner:i},{headers:{Authorization:`Bearer ${c.getToken()}`}})).data}catch{return}},async updateRows(i){try{return(await h.put(`${x.serverUrl}/manage/banner/updateRows`,{banner:i},{headers:{Authorization:`Bearer ${c.getToken()}`}})).data}catch{return}},async getAllList(){try{return(await h.get(`${x.serverUrl}/manage/banner/list/all`,{headers:{Authorization:`Bearer ${c.getToken()}`}})).data}catch{c.clearLocalCredential(),window.location.replace("/");return}},async getList(i){try{return(await h.get(`${x.serverUrl}/manage/banner/list?page=${i.toString()}`,{headers:{Authorization:`Bearer ${c.getToken()}`}})).data}catch{c.clearLocalCredential(),window.location.replace("/");return}},async get(i){try{return(await h.get(`${x.serverUrl}/manage/banner/get?id=${i.toString()}`,{headers:{Authorization:`Bearer ${c.getToken()}`}})).data}catch{c.clearLocalCredential(),window.location.replace("/");return}},async create(i){try{return(await h.post(`${x.serverUrl}/manage/banner/create`,{banner:i},{headers:{Authorization:`Bearer ${c.getToken()}`}})).data}catch{return}},async update(i){try{return(await h.put(`${x.serverUrl}/manage/banner/update`,{banner:i},{headers:{Authorization:`Bearer ${c.getToken()}`}})).data}catch{return}},async updateProfile(i,n,o,g,C){try{return(await h.put(`${x.serverUrl}/manage/banner/updateProfile`,{id:i,nickName:n,cellPhone:o},{headers:{Authorization:`Bearer ${c.getToken()}`}})).data}catch{c.clearLocalCredential(),window.location.replace("/");return}},async delete(i){try{return(await h.delete(`${x.serverUrl}/manage/banner/delete?id=${i}`,{headers:{Authorization:`Bearer ${c.getToken()}`}})).data}catch{c.clearLocalCredential(),window.location.replace("/");return}},async addAttachment(i){try{return(await h.post(`${x.serverUrl}/upload/data/banner`,i,{headers:{Authorization:`Bearer ${c.getToken()}`,"Content-Type":"multipart/form-data"}})).data}catch(n){console.error(n);return}},async deleteAttachment(i){try{return(await h.delete(`${x.serverUrl}/upload/image?filename=${i}`,{headers:{Authorization:`Bearer ${c.getToken()}`}})).data}catch{c.clearLocalCredential(),window.location.replace("/");return}}};function P(){N();const[i,n]=f.useState([]),[o,g]=f.useState({}),[C,p]=f.useState({});f.useEffect(()=>{(async()=>{const s=await j.getByEntityType("banner1");n(s);const l={},r={};s.forEach(t=>{t.image_file&&(l[t.id]=t.image_file,r[t.id]=t.image_file)}),g(l),p(r)})()},[]);const B=async(a,s)=>{var r;const l=(r=s.target.files)==null?void 0:r[0];if(l){if(l.size>5242880){alert("파일 크기는 5MB 이하여야 합니다.");return}g(d=>({...d,[a]:l})),p(d=>({...d,[a]:l.name}))}},T=()=>{const a=i.reduce((s,l)=>Math.max(s,l.id||0),0);n([...i,{id:a+1,entity_type:"banner1",image_file:"",link_url:"",additional_text:JSON.stringify({text1:"",text2:"",text3:"",text4:"",text5:""})}])},F=async a=>{a.preventDefault();try{const s=[],l=i.map(async t=>{if(t.id){const d=new FormData,{id:I,...v}=t;if(o[t.id]&&o[t.id]instanceof File){d.append("file",o[t.id]);const u=await j.addAttachment(d),k=`${x.serverUrl}/${u.path.replace(/\\/g,"/")}`,E={...v,created_date:new Date,image_file:k};s.push(E)}else if(o[t.id]&&typeof o[t.id]=="string"){const u={...v,created_date:new Date,image_file:o[t.id]};s.push(u)}else{const u={...v,created_date:new Date,image_file:""};s.push(u)}}});await Promise.all(l),await j.deleteByEntityType("banner1"),await j.createRows(s)?_.success("배너 등록 완료"):_.error("배너 등록에 실패했습니다.")}catch(s){console.error("오류 발생:",s),_.error("오류가 발생했습니다. 다시 시도해주세요.")}};return e.jsx("form",{onSubmit:F,children:e.jsxs(y,{spacing:{xs:3,md:3},sx:{mt:3,mx:"auto",maxWidth:{xs:720,xl:1200}},children:[i.map((a,s)=>{const l=a.additional_text.replace(/[\n\r]/g,"\\n");let r;try{r=JSON.parse(l)}catch(t){console.error("JSON 파싱 실패:",t),r={}}return e.jsxs(R,{children:[e.jsx(U,{title:`배너 ${s+1}`}),e.jsx(A,{}),e.jsx(y,{spacing:3,sx:{p:3},children:e.jsxs(m,{rowGap:3,columnGap:2,display:"grid",gridTemplateColumns:{xs:"repeat(1, 1fr)",sm:"repeat(2, 1fr)"},children:[e.jsx(w,{label:"악기명",name:"text1",value:r.text1,onChange:t=>{r.text1=t.target.value,a.additional_text=JSON.stringify(r),n([...i])},fullWidth:!0}),e.jsx(w,{label:"강사명",name:"text2",value:r.text2,onChange:t=>{r.text2=t.target.value,a.additional_text=JSON.stringify(r),n([...i])},fullWidth:!0}),e.jsx(w,{label:"소개글1",name:"text3",multiline:!0,rows:5,value:r.text3,onChange:t=>{r.text3=t.target.value,a.additional_text=JSON.stringify(r),n([...i])},fullWidth:!0}),e.jsx(w,{label:"소개글2",name:"text4",multiline:!0,rows:5,value:r.text4,onChange:t=>{r.text4=t.target.value,a.additional_text=JSON.stringify(r),n([...i])},fullWidth:!0}),e.jsx(w,{label:"링크",name:"text5",value:r.text5,onChange:t=>{r.text5=t.target.value,a.additional_text=JSON.stringify(r),n([...i])},fullWidth:!0}),e.jsxs(m,{sx:{pl:"14px"},children:[e.jsx($,{variant:"subtitle2",children:"이미지 선택"}),e.jsxs(m,{children:[e.jsx("input",{type:"file",id:`file${s}`,style:{display:"none"},onChange:t=>B(a.id,t)}),o[a.id]&&typeof o[a.id]=="string"?e.jsx(m,{sx:{mb:2},children:e.jsx("img",{src:o[a.id],alt:"이미지",style:{maxWidth:"200px",maxHeight:"200px"}})}):o[a.id]instanceof File?e.jsx(m,{sx:{mb:2},children:e.jsx("img",{src:URL.createObjectURL(o[a.id]),alt:"이미지",style:{maxWidth:"200px",maxHeight:"200px"}})}):null,e.jsxs(y,{spacing:2,direction:"row",alignItems:"center",children:[e.jsx(S,{variant:"contained",component:"label",htmlFor:`file${s}`,children:"파일 선택"}),e.jsx($,{sx:{flex:1},children:C[a.id]||"선택된 파일 없음"}),o[a.id]&&e.jsx(D,{onClick:()=>{const t=document.getElementById(`file${s}`);t&&(t.value=""),g(d=>({...d,[a.id]:null})),p(d=>({...d,[a.id]:"선택된 파일 없음"}))},children:e.jsx(b,{icon:"mdi:delete"})})]})]})]})]})})]},a.id)}),e.jsxs(y,{direction:"row",spacing:2,alignItems:"center",justifyContent:"flex-end",sx:{mt:3},children:[e.jsx(S,{size:"large",variant:"contained",onClick:T,sx:{backgroundColor:"#808080","&:hover":{backgroundColor:"#666666"}},children:"배너 추가"}),e.jsx(W,{type:"submit",variant:"contained",size:"large",children:"등록 완료"})]})]})})}function H(){N();const[i,n]=f.useState([]),[o,g]=f.useState({}),[C,p]=f.useState({});f.useEffect(()=>{(async()=>{const s=await j.getByEntityType("banner2");n(s);const l={},r={};s.forEach(t=>{t.image_file&&(l[t.id]=t.image_file,r[t.id]=t.image_file)}),g(l),p(r)})()},[]);const B=async(a,s)=>{var r;const l=(r=s.target.files)==null?void 0:r[0];if(l){if(l.size>5242880){alert("파일 크기는 5MB 이하여야 합니다.");return}g(d=>({...d,[a]:l})),p(d=>({...d,[a]:l.name}))}},T=()=>{const a=i.reduce((s,l)=>Math.max(s,l.id||0),0);n([...i,{id:a+1,entity_type:"banner2",image_file:"",link_url:"",additional_text:JSON.stringify({text1:""})}])},F=async a=>{a.preventDefault();try{const s=[],l=i.map(async t=>{if(t.id){const d=new FormData,{id:I,...v}=t;if(o[t.id]&&o[t.id]instanceof File){d.append("file",o[t.id]);const u=await j.addAttachment(d),k=`${x.serverUrl}/${u.path.replace(/\\/g,"/")}`,E={...v,created_date:new Date,image_file:k};s.push(E)}else if(o[t.id]&&typeof o[t.id]=="string"){const u={...v,created_date:new Date,image_file:o[t.id]};s.push(u)}else{const u={...v,created_date:new Date,image_file:""};s.push(u)}}});await Promise.all(l),await j.deleteByEntityType("banner2"),await j.createRows(s)?_.success("배너 등록 완료"):_.error("배너 등록에 실패했습니다.")}catch(s){console.error("오류 발생:",s),_.error("오류가 발생했습니다. 다시 시도해주세요.")}};return e.jsx("form",{onSubmit:F,children:e.jsxs(y,{spacing:{xs:3,md:3},sx:{mt:3,mx:"auto",maxWidth:{xs:720,xl:1200}},children:[i.map((a,s)=>{const l=a.additional_text.replace(/\n/gi,"\\r\\n"),r=JSON.parse(l);return e.jsxs(R,{children:[e.jsx(U,{title:`배너 ${s+1}`}),e.jsx(A,{}),e.jsx(y,{spacing:3,sx:{p:3},children:e.jsxs(m,{rowGap:3,columnGap:2,display:"grid",gridTemplateColumns:{xs:"repeat(1, 1fr)",sm:"repeat(2, 1fr)"},children:[e.jsx(w,{label:"링크",name:"text1",value:r.text1,onChange:t=>{r.text1=t.target.value,a.additional_text=JSON.stringify(r),n([...i])},fullWidth:!0}),e.jsxs(m,{sx:{pl:"14px"},children:[e.jsx($,{variant:"subtitle2",children:"이미지 선택"}),e.jsxs(m,{children:[e.jsx("input",{type:"file",id:`file${s}`,style:{display:"none"},onChange:t=>B(a.id,t)}),o[a.id]&&typeof o[a.id]=="string"?e.jsx(m,{sx:{mb:2},children:e.jsx("img",{src:o[a.id],alt:"이미지",style:{maxWidth:"200px",maxHeight:"200px"}})}):o[a.id]instanceof File?e.jsx(m,{sx:{mb:2},children:e.jsx("img",{src:URL.createObjectURL(o[a.id]),alt:"이미지",style:{maxWidth:"200px",maxHeight:"200px"}})}):null,e.jsxs(y,{spacing:2,direction:"row",alignItems:"center",children:[e.jsx(S,{variant:"contained",component:"label",htmlFor:`file${s}`,children:"파일 선택"}),e.jsx($,{sx:{flex:1},children:C[a.id]||"선택된 파일 없음"}),o[a.id]&&e.jsx(D,{onClick:()=>{const t=document.getElementById(`file${s}`);t&&(t.value=""),g(d=>({...d,[a.id]:null})),p(d=>({...d,[a.id]:"선택된 파일 없음"}))},children:e.jsx(b,{icon:"mdi:delete"})})]})]})]})]})})]},a.id)}),e.jsxs(y,{direction:"row",spacing:2,alignItems:"center",justifyContent:"flex-end",sx:{mt:3},children:[e.jsx(S,{size:"large",variant:"contained",onClick:T,sx:{backgroundColor:"#808080","&:hover":{backgroundColor:"#666666"}},children:"배너 추가"}),e.jsx(W,{type:"submit",variant:"contained",size:"large",children:"등록 완료"})]})]})})}function G(){N();const[i,n]=f.useState([]),[o,g]=f.useState({}),[C,p]=f.useState({});f.useEffect(()=>{(async()=>{const s=await j.getByEntityType("banner3");n(s);const l={},r={};s.forEach(t=>{t.image_file&&(l[t.id]=t.image_file,r[t.id]=t.image_file)}),g(l),p(r)})()},[]);const B=async(a,s)=>{var r;const l=(r=s.target.files)==null?void 0:r[0];if(l){if(l.size>5242880){alert("파일 크기는 5MB 이하여야 합니다.");return}g(d=>({...d,[a]:l})),p(d=>({...d,[a]:l.name}))}},T=()=>{const a=i.reduce((s,l)=>Math.max(s,l.id||0),0);n([...i,{id:a+1,entity_type:"banner3",image_file:"",link_url:"",additional_text:JSON.stringify({text1:"",text2:"",text3:"",text4:""})}])},F=async a=>{a.preventDefault();try{const s=[],l=i.map(async t=>{if(t.id){const d=new FormData,{id:I,...v}=t;if(o[t.id]&&o[t.id]instanceof File){d.append("file",o[t.id]);const u=await j.addAttachment(d),k=`${x.serverUrl}/${u.path.replace(/\\/g,"/")}`,E={...v,created_date:new Date,image_file:k};s.push(E)}else if(o[t.id]&&typeof o[t.id]=="string"){const u={...v,created_date:new Date,image_file:o[t.id]};s.push(u)}else{const u={...v,created_date:new Date,image_file:""};s.push(u)}}});await Promise.all(l),await j.deleteByEntityType("banner3"),await j.createRows(s)?_.success("배너 등록 완료"):_.error("배너 등록에 실패했습니다.")}catch(s){console.error("오류 발생:",s),_.error("오류가 발생했습니다. 다시 시도해주세요.")}};return e.jsx("form",{onSubmit:F,children:e.jsxs(y,{spacing:{xs:3,md:3},sx:{mt:3,mx:"auto",maxWidth:{xs:720,xl:1200}},children:[i.map((a,s)=>{const l=a.additional_text.replace(/\n/gi,"\\r\\n"),r=JSON.parse(l);return e.jsxs(R,{children:[e.jsx(U,{title:`배너 ${s+1}`}),e.jsx(A,{}),e.jsx(y,{spacing:3,sx:{p:3},children:e.jsxs(m,{rowGap:3,columnGap:2,display:"grid",gridTemplateColumns:{xs:"repeat(1, 1fr)",sm:"repeat(2, 1fr)"},children:[e.jsx(w,{label:"제목",name:"text1",multiline:!0,rows:5,value:r.text1,onChange:t=>{r.text1=t.target.value,a.additional_text=JSON.stringify(r),n([...i])},fullWidth:!0}),e.jsx(w,{label:"내용",name:"text2",multiline:!0,rows:5,value:r.text2,onChange:t=>{r.text2=t.target.value,a.additional_text=JSON.stringify(r),n([...i])},fullWidth:!0}),e.jsx(w,{label:"작성자",name:"text3",value:r.text3,onChange:t=>{r.text3=t.target.value,a.additional_text=JSON.stringify(r),n([...i])},fullWidth:!0}),e.jsx(w,{label:"링크",name:"text4",value:r.text4,onChange:t=>{r.text4=t.target.value,a.additional_text=JSON.stringify(r),n([...i])},fullWidth:!0}),e.jsxs(m,{sx:{pl:"14px"},children:[e.jsx($,{variant:"subtitle2",children:"이미지 선택"}),e.jsxs(m,{children:[e.jsx("input",{type:"file",id:`file${s}`,style:{display:"none"},onChange:t=>B(a.id,t)}),o[a.id]&&typeof o[a.id]=="string"?e.jsx(m,{sx:{mb:2},children:e.jsx("img",{src:o[a.id],alt:"이미지",style:{maxWidth:"200px",maxHeight:"200px"}})}):o[a.id]instanceof File?e.jsx(m,{sx:{mb:2},children:e.jsx("img",{src:URL.createObjectURL(o[a.id]),alt:"이미지",style:{maxWidth:"200px",maxHeight:"200px"}})}):null,e.jsxs(y,{spacing:2,direction:"row",alignItems:"center",children:[e.jsx(S,{variant:"contained",component:"label",htmlFor:`file${s}`,children:"파일 선택"}),e.jsx($,{sx:{flex:1},children:C[a.id]||"선택된 파일 없음"}),o[a.id]&&e.jsx(D,{onClick:()=>{const t=document.getElementById(`file${s}`);t&&(t.value=""),g(d=>({...d,[a.id]:null})),p(d=>({...d,[a.id]:"선택된 파일 없음"}))},children:e.jsx(b,{icon:"mdi:delete"})})]})]})]})]})})]},a.id)}),e.jsxs(y,{direction:"row",spacing:2,alignItems:"center",justifyContent:"flex-end",sx:{mt:3},children:[e.jsx(S,{size:"large",variant:"contained",onClick:T,sx:{backgroundColor:"#808080","&:hover":{backgroundColor:"#666666"}},children:"배너 추가"}),e.jsx(W,{type:"submit",variant:"contained",size:"large",children:"등록 완료"})]})]})})}const Z=[{value:"banner1",label:"메인페이지 슬라이드1"},{value:"banner2",label:"메인페이지 슬라이드2"},{value:"banner3",label:"메인페이지 리뷰관리"}];function X(){const i=z("banner1");return e.jsxs(L,{children:[e.jsx(O,{heading:"배너 관리",links:[{name:"Home",href:"/"},{name:"배너관리"}],sx:{mb:{xs:3,md:5}}}),e.jsxs(e.Fragment,{children:[e.jsx(m,{sx:{mt:3,pl:1,mx:"auto",maxWidth:{xs:"100%",xl:1200},width:"100%"},children:e.jsx(J,{value:i.value,onChange:i.onChange,children:Z.map(n=>e.jsx(M,{value:n.value,label:e.jsx("span",{style:{fontWeight:"bold"},children:n.label})},n.value))})}),i.value==="banner1"&&e.jsx(P,{}),i.value==="banner2"&&e.jsx(H,{}),i.value==="banner3"&&e.jsx(G,{})]})]})}function ne(){return e.jsx(e.Fragment,{children:e.jsx(X,{})})}export{ne as default};
