import{ah as M,r,R as z,bi as c,Y as D,D as e,V as p,a6 as A,F as o,T as h,W as E,ak as N,Z as U}from"./index-DJm73Gd8.js";import{z as n}from"./index-DXqQCM1T.js";import{t as G,F as V}from"./form-provider-Bv2QLm_X.js";import{u as Z,F as _}from"./fields-DRFNYTBH.js";import"./ko-DBbRYMOz.js";import"./image-DPed605N.js";import{I as u}from"./InstrumentService-CF3tqggI.js";import{C as P}from"./Card-DCic7xzO.js";import{C as X}from"./CardHeader-qrX2o-AK.js";import{L as W}from"./LoadingButton-8OnUjDzw.js";const k=n.object({name:n.string().min(2,{message:"악기명을 입력해 주세요"}),image_file1:n.string(),image_file2:n.string(),display_order:n.number(),is_deleted:n.string(),created_date:n.date()}),$=k.extend({id:n.number()});function de({currentItem:s}){var v,C;const m=M(),g=r.useMemo(()=>({id:(s==null?void 0:s.id)||0,name:(s==null?void 0:s.name)||"",image_file1:(s==null?void 0:s.image_file1)||"",image_file2:(s==null?void 0:s.image_file2)||"",display_order:(s==null?void 0:s.display_order)||1,is_deleted:(s==null?void 0:s.is_deleted)||"N",created_date:s!=null&&s.created_date?new Date(s.created_date):new Date}),[s]),B=r.useMemo(()=>s?$:k,[s]),F=Z({mode:"onSubmit",resolver:G(B),defaultValues:g}),{setValue:J,reset:j,watch:O,control:K,handleSubmit:T,formState:{isSubmitting:Y}}=F;r.useEffect(()=>{s&&j(g)},[s,g,j]),O();const[i,f]=r.useState({1:null,2:null});r.useEffect(()=>{s&&f({1:s.image_file1||null,2:s.image_file2||null})},[s]);const[w,y]=r.useState({1:"선택된 파일 없음",2:"선택된 파일 없음"}),S=async(a,l)=>{var d;const t=(d=l.target.files)==null?void 0:d[0];if(t){if(t.size>5242880){alert("파일 크기는 5MB 이하여야 합니다.");return}f(x=>({...x,[a]:t})),y(x=>({...x,[a]:t.name}))}},H=T(async a=>{try{const l={};try{const d=Object.entries(i).filter(([b,x])=>x instanceof File).map(async([b,x])=>{const R=new FormData;R.append("file",x);const L=await u.addAttachment(R);L.filename&&(l[Number(b)]=`${z.serverUrl}/${L.path.replace(/\\/g,"/")}`)});await Promise.all(d),a.image_file1=l[1]||(typeof i[1]=="string"?i[1]:""),a.image_file2=l[2]||(typeof i[2]=="string"?i[2]:"")}catch(d){console.error("파일 업로드 에러:",d),alert("파일 업로드에 실패했습니다.");return}const t={...a,id:(s==null?void 0:s.id)||void 0,display_order:a.display_order||0,is_deleted:a.is_deleted||"N",created_date:a.created_date||new Date};s?await u.update(t)==="success"?(c.success("악기 정보가 수정되었습니다."),m.push(D.instrument.list)):c.error("악기 수정에 실패했습니다."):await u.create(t)?(c.success("악기 정보가 등록되었습니다."),m.push(D.instrument.list)):c.error("악기 등록에 실패했습니다."),j()}catch(l){console.error("오류 발생:",l),c.error("오류가 발생했습니다. 다시 시도해주세요.")}});return e.jsx(V,{methods:F,onSubmit:H,children:e.jsxs(p,{spacing:{xs:3,md:5},sx:{mt:3,mx:"auto",maxWidth:{xs:720,xl:1200}},children:[e.jsxs(P,{children:[e.jsx(X,{title:"기본 정보",subheader:"",sx:{mb:1}}),e.jsx(A,{}),e.jsx(p,{spacing:3,sx:{p:3},children:e.jsxs(o,{rowGap:3,columnGap:2,display:"grid",gridTemplateColumns:{xs:"repeat(1, 1fr)",sm:"repeat(2, 1fr)"},children:[e.jsx(_.Text,{name:"name",label:"악기명"}),e.jsx(_.Text,{name:"display_order",label:"노출 순서",type:"number"}),e.jsxs(o,{sx:{pl:"14px"},children:[e.jsx(h,{variant:"subtitle2",children:"선택전 썸네일"}),e.jsx("br",{}),e.jsxs(o,{children:[e.jsx("input",{type:"file",id:"file1",style:{display:"none"},onChange:a=>{var t;((t=a.target.files)==null?void 0:t[0])&&S(1,a)}},i[1]?"hasFile":"noFile"),typeof i[1]=="string"?e.jsx(o,{sx:{mb:2},children:e.jsx("img",{src:i[1],alt:"이미지",style:{maxWidth:"200px",maxHeight:"200px"}})}):i[1]?(v=i[1])!=null&&v.type.startsWith("image/")?e.jsx(o,{sx:{mb:2},children:e.jsx("img",{src:URL.createObjectURL(i[1]),alt:"이미지",style:{maxWidth:"200px",maxHeight:"200px"}})}):e.jsx(o,{sx:{mb:2},children:e.jsxs("a",{href:URL.createObjectURL(i[1]),download:!0,children:["다운로드 [",i[1].name,"]"]})}):null,e.jsxs(p,{spacing:2,direction:"row",alignItems:"center",children:[e.jsx(E,{variant:"contained",component:"label",htmlFor:"file1",children:"파일 선택"}),e.jsx(h,{sx:{flex:1},children:w[1]}),i[1]&&e.jsx(N,{onClick:()=>{const a=document.getElementById("file1");a&&(a.value=""),f(l=>({...l,1:null})),y(l=>({...l,1:"선택된 파일 없음"}))},children:e.jsx(U,{icon:"mdi:delete"})})]})]})]}),e.jsxs(o,{sx:{pl:"14px"},children:[e.jsx(h,{variant:"subtitle2",children:"선택후 썸네일"}),e.jsx("br",{}),e.jsxs(o,{children:[e.jsx("input",{type:"file",id:"file2",style:{display:"none"},onChange:a=>{var t;((t=a.target.files)==null?void 0:t[0])&&S(2,a)}},i[2]?"hasFile":"noFile"),typeof i[2]=="string"?e.jsx(o,{sx:{mb:2},children:e.jsx("img",{src:i[2],alt:"이미지",style:{maxWidth:"200px",maxHeight:"200px"}})}):i[2]?(C=i[2])!=null&&C.type.startsWith("image/")?e.jsx(o,{sx:{mb:2},children:e.jsx("img",{src:URL.createObjectURL(i[2]),alt:"이미지",style:{maxWidth:"200px",maxHeight:"200px"}})}):e.jsx(o,{sx:{mb:2},children:e.jsxs("a",{href:URL.createObjectURL(i[2]),download:!0,children:["다운로드 [",i[2].name,"]"]})}):null,e.jsxs(p,{spacing:2,direction:"row",alignItems:"center",children:[e.jsx(E,{variant:"contained",component:"label",htmlFor:"file2",children:"파일 선택"}),e.jsx(h,{sx:{flex:1},children:w[2]}),i[2]&&e.jsx(N,{onClick:()=>{const a=document.getElementById("file2");a&&(a.value=""),f(l=>({...l,2:null})),y(l=>({...l,2:"선택된 파일 없음"}))},children:e.jsx(U,{icon:"mdi:delete"})})]})]})]}),e.jsx(_.Text,{name:"created_date",label:"생성일",value:s!=null&&s.created_date?new Date(s.created_date).toLocaleDateString("ko-KR",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}):"",disabled:!0})]})})]}),e.jsxs(p,{direction:"row",alignItems:"flex-end",justifyContent:"flex-end",sx:{mt:3,gap:"10px"},children:[e.jsx(W,{color:"inherit",size:"large",variant:"outlined",onClick:()=>m.back(),children:"목록으로"}),e.jsx(W,{type:"submit",variant:"contained",size:"large",children:s?"수정 완료":"등록 완료"})]})]})})}export{de as N};
