import{ah as P,r as m,R as M,bi as t,Y as k,D as l,V as _,W as E,a6 as x,F as h}from"./index-DJm73Gd8.js";import{z as i}from"./index-DXqQCM1T.js";import{t as N,F as R}from"./form-provider-Bv2QLm_X.js";import{u as V,F as o}from"./fields-DRFNYTBH.js";import{M as e}from"./ko-DBbRYMOz.js";import"./image-DPed605N.js";import{M as v}from"./MemberService-CCBPPnBE.js";import{C as y}from"./Card-DCic7xzO.js";import{C as w}from"./CardHeader-qrX2o-AK.js";import{L as T}from"./LoadingButton-8OnUjDzw.js";const $=i.object({user_id:i.string().min(3,{message:"아이디를 입력해 주세요"}),password:i.string().min(4,{message:"비밀번호를 입력해 주세요"}),name:i.string().min(2,{message:"이름을 입력해 주세요"}),cellphone:i.string(),nickname:i.string(),type:i.number(),login_type:i.string(),login_ci_data:i.string(),image_file:i.string(),address1:i.string(),address2:i.string(),address3:i.string(),zip:i.string(),foreign_address:i.string(),gender:i.string(),school_name:i.string(),grade:i.string(),memo:i.string(),zoom_link_url:i.string(),voov_link_url:i.string(),voov_link_exposed_members:i.string(),parent_name:i.string(),parent_cellphone:i.string(),status:i.number(),approve_date:i.date(),leave_date:i.date().nullable().optional(),leave_message:i.string(),agree_marketing:i.string(),notification_type:i.string(),registration_source:i.string(),last_login:i.date().nullable().optional(),created_date:i.date()}),B=i.object({user_id:i.string().min(3,{message:"아이디를 입력해 주세요"}),name:i.string().min(2,{message:"이름을 입력해 주세요"}),password:i.string(),cellphone:i.string(),nickname:i.string(),type:i.number(),login_type:i.string(),login_ci_data:i.string(),image_file:i.string(),address1:i.string(),address2:i.string(),address3:i.string(),zip:i.string(),foreign_address:i.string(),gender:i.string(),school_name:i.string(),grade:i.string(),memo:i.string(),zoom_link_url:i.string(),voov_link_url:i.string(),voov_link_exposed_members:i.string(),parent_name:i.string(),parent_cellphone:i.string(),status:i.number(),approve_date:i.date(),leave_date:i.date().nullable().optional(),leave_message:i.string(),agree_marketing:i.string(),notification_type:i.string(),registration_source:i.string(),last_login:i.date().nullable().optional(),created_date:i.date()});function r({currentUser:a}){const n=P(),j=m.useMemo(()=>({id:(a==null?void 0:a.id)||0,type:(a==null?void 0:a.type)||10,user_id:(a==null?void 0:a.user_id)||"",password:"",login_type:(a==null?void 0:a.login_type)||"이메일",login_ci_data:(a==null?void 0:a.login_ci_data)||"",name:(a==null?void 0:a.name)||"",image_file:(a==null?void 0:a.image_file)||"",nickname:(a==null?void 0:a.nickname)||"",cellphone:(a==null?void 0:a.cellphone)||"",address1:(a==null?void 0:a.address1)||"",address2:(a==null?void 0:a.address2)||"",address3:(a==null?void 0:a.address3)||"",zip:(a==null?void 0:a.zip)||"",foreign_address:(a==null?void 0:a.foreign_address)||"",gender:(a==null?void 0:a.gender)||"남자",school_name:(a==null?void 0:a.school_name)||"",grade:(a==null?void 0:a.grade)||"",memo:(a==null?void 0:a.memo)||"",zoom_link_url:(a==null?void 0:a.zoom_link_url)||"",voov_link_url:(a==null?void 0:a.voov_link_url)||"",voov_link_exposed_members:(a==null?void 0:a.voov_link_exposed_members)||"",parent_name:(a==null?void 0:a.parent_name)||"",parent_cellphone:(a==null?void 0:a.parent_cellphone)||"",status:(a==null?void 0:a.status)||20,approve_date:a!=null&&a.approve_date?new Date(a.approve_date):new Date,leave_date:a!=null&&a.leave_date?new Date(a.leave_date):void 0,leave_message:(a==null?void 0:a.leave_message)||"",agree_marketing:(a==null?void 0:a.agree_marketing)||"동의",notification_type:(a==null?void 0:a.notification_type)||"이메일",registration_source:(a==null?void 0:a.registration_source)||"지인소개",last_login:a!=null&&a.last_login?new Date(a.last_login):void 0,created_date:a!=null&&a.created_date?new Date(a.created_date):new Date}),[a]),D=m.useMemo(()=>a?B:$,[a]),g=V({mode:"onSubmit",resolver:N(D),defaultValues:j}),C="https://tamburinmusic.com",{reset:b,watch:F,control:W,handleSubmit:L,formState:{isSubmitting:K}}=g;m.useEffect(()=>{a&&b(j)},[a,j,b]),F();const G=L(async d=>{try{try{const s=Object.entries(I).filter(([p,f])=>f!==null).map(([p,f])=>{const z=new FormData;return z.append("file",f),v.addAttachment(z)}),S=await Promise.all(s);if(S.some(p=>p.filename==="")){alert("파일 업로드에 실패했습니다.");return}const A=S.map(p=>`${M.serverUrl}/uploads/${p.filename}`)}catch(s){console.error("파일 업로드 에러:",s),alert("파일 업로드에 실패했습니다.")}a?await v.update({...d,id:a.id,leave_date:d.leave_date||void 0,last_login:d.last_login||void 0})==="success"?(t.success("회원 정보가 수정되었습니다."),n.push(k.member.list)):t.error("회원 수정에 실패했습니다."):await v.create({...g.getValues(),leave_date:void 0,last_login:void 0})?(t.success("회원 정보가 등록되었습니다."),n.push(k.member.list)):t.error("회원 등록에 실패했습니다."),b()}catch(s){console.error(s),t.error("오류가 발생했습니다. 다시 시도해주세요.")}});m.useCallback(async d=>{d&&v.delete(d).then(s=>{t.success("해당 유저 정보를 삭제하였습니다."),n.push(k.member.list)})},[n]);const[I,O]=m.useState({1:null,2:null,3:null});return m.useState({1:"선택된 파일 없음",2:"선택된 파일 없음",3:"선택된 파일 없음"}),l.jsx(R,{methods:g,onSubmit:G,children:l.jsxs(_,{spacing:{xs:3,md:5},sx:{mt:3,mx:"auto",maxWidth:{xs:720,xl:1200}},children:[l.jsxs(y,{children:[l.jsx(w,{title:"기본 정보",subheader:"",sx:{mb:1},action:a&&l.jsx("a",{href:`${C}/auth/admin/${a==null?void 0:a.user_id}`,target:"_blank",rel:"noreferrer",children:l.jsx(E,{variant:"soft",color:"info",sx:{fontSize:"13px",fontWeight:900},children:"회원으로 로그인"})})}),l.jsx(x,{}),l.jsxs(_,{spacing:3,sx:{p:3},children:[l.jsxs(h,{rowGap:3,columnGap:2,display:"grid",gridTemplateColumns:{xs:"repeat(1, 1fr)",sm:"repeat(2, 1fr)"},children:[l.jsx(o.Text,{name:"user_id",label:"아이디"}),l.jsx(o.Text,{name:"password",label:a?"비밀번호 변경":"비밀번호",type:"password"}),l.jsx(o.Text,{name:"name",label:"이름"}),l.jsx(o.Text,{name:"cellphone",label:"연락처"}),l.jsxs(o.Select,{name:"gender",size:"medium",label:"성별",InputLabelProps:{shrink:!0},children:[l.jsx(e,{value:"남자",children:"남자"}),l.jsx(e,{value:"여자",children:"여자"})]})]}),l.jsx(x,{}),l.jsx(h,{rowGap:3,columnGap:2,display:"grid",gridTemplateColumns:{xs:"repeat(1, 1fr)",sm:"repeat(2, 1fr)"},children:l.jsx(o.Text,{name:"address1",label:"주소"})})]})]}),l.jsxs(y,{children:[l.jsx(w,{title:"추가 정보 ",subheader:"",sx:{mb:1}}),l.jsx(x,{}),l.jsx(_,{spacing:3,sx:{p:3},children:l.jsxs(h,{rowGap:3,columnGap:2,display:"grid",gridTemplateColumns:{xs:"repeat(1, 1fr)",sm:"repeat(2, 1fr)"},children:[l.jsx(o.Text,{name:"school_name",label:"학교명"}),l.jsx(o.Text,{name:"grade",label:"학년"}),l.jsx(o.Text,{name:"parent_name",label:"부모님 이름"}),l.jsx(o.Text,{name:"parent_cellphone",label:"부모님 휴대폰번호"}),l.jsx(o.Text,{name:"memo",label:"참고사항"})]})})]}),l.jsxs(y,{children:[l.jsx(w,{title:"계정 정보",subheader:"",sx:{mb:1}}),l.jsx(x,{}),l.jsx(_,{spacing:3,sx:{p:3},children:l.jsxs(h,{rowGap:3,columnGap:2,display:"grid",gridTemplateColumns:{xs:"repeat(1, 1fr)",sm:"repeat(2, 1fr)"},children:[l.jsxs(o.Select,{name:"status",size:"medium",label:"회원 상태",InputLabelProps:{shrink:!0},onChange:d=>{const s=Number(d.target.value);g.setValue("status",s),s===20&&g.setValue("approve_date",new Date)},children:[l.jsx(e,{value:20,children:"활동"}),l.jsx(e,{value:40,children:"탈퇴"})]}),l.jsx("br",{}),l.jsxs(o.Select,{name:"registration_source",size:"medium",label:"가입 경로",InputLabelProps:{shrink:!0},children:[l.jsx(e,{value:"지인소개",children:"지인소개"}),l.jsx(e,{value:"인스타그램",children:"인스타그램"}),l.jsx(e,{value:"페이스북",children:"페이스북"}),l.jsx(e,{value:"인터넷검색",children:"인터넷검색"}),l.jsx(e,{value:"블로그",children:"블로그"}),l.jsx(e,{value:"기타",children:"기타"})]}),l.jsxs(o.Select,{name:"login_type",size:"medium",label:"로그인 타입",InputLabelProps:{shrink:!0},children:[l.jsx(e,{value:"이메일",children:"이메일"}),l.jsx(e,{value:"카카오",children:"카카오"}),l.jsx(e,{value:"네이버",children:"네이버"})]}),l.jsxs(o.Select,{name:"notification_type",size:"medium",label:"알림 설정",InputLabelProps:{shrink:!0},children:[l.jsx(e,{value:"이메일",children:"이메일"}),l.jsx(e,{value:"카카오알림톡",children:"카카오알림톡"})]}),l.jsxs(o.Select,{name:"agree_marketing",size:"medium",label:"마케팅 동의",InputLabelProps:{shrink:!0},children:[l.jsx(e,{value:"동의",children:"동의"}),l.jsx(e,{value:"미동의",children:"미동의"})]}),l.jsx(o.Text,{name:"last_login",label:"최근 접속일",value:a!=null&&a.last_login?new Date(a.last_login).toLocaleDateString("ko-KR",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}):"",disabled:!0}),l.jsx(o.Text,{name:"created_date",label:"생성일",value:a!=null&&a.created_date?new Date(a.created_date).toLocaleDateString("ko-KR",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}):"",disabled:!0})]})})]}),l.jsxs(_,{direction:"row",alignItems:"flex-end",justifyContent:"flex-end",sx:{mt:3,gap:"10px"},children:[l.jsx(T,{color:"inherit",size:"large",variant:"outlined",onClick:()=>n.back(),children:"목록으로"}),l.jsx(T,{type:"submit",variant:"contained",size:"large",children:a?"수정 완료":"등록 완료"})]})]})})}export{r as N};
