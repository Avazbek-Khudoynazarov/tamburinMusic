import{ah as P,r,D as e,V as o,a6 as f,F as x,T as j,W as D,ak as O,Z as M,R as L,bi as y,bj as A}from"./index-DJm73Gd8.js";import{u as z}from"./use-tabs-B1gcKklP.js";import{C as G}from"./custom-breadcrumbs-BsaNbwZB.js";import{M as u}from"./MetaService-BYYEBCFd.js";import{C as v}from"./Card-DCic7xzO.js";import{C as F}from"./CardHeader-qrX2o-AK.js";import{T as J}from"./TextField-B_joUv90.js";import{L as Z}from"./LoadingButton-8OnUjDzw.js";import"./AuthService-foVeZrRB.js";import"./ListContext-CDIiNrC7.js";function q(){const k=P(),[b,B]=r.useState([]),[R,$]=r.useState([]),[c,N]=r.useState([]),[h,p]=r.useState({1:null,2:null,3:null}),[V,g]=r.useState({1:"선택된 파일 없음",2:"선택된 파일 없음",3:"선택된 파일 없음"}),[C,S]=r.useState(""),[l,_]=r.useState(null),[I,w]=r.useState("선택된 파일 없음"),E=r.useCallback(async()=>{try{const[n,t,s]=await Promise.all([u.getList("settingsBanner"),u.getList("settingsExchange"),u.getList("settingsVideo")]);if(B(n),$(t),N(s),n){const a={},i={};n.forEach((d,m)=>{a[m+1]=(d.entity_value,null),i[m+1]=d.entity_value||"선택된 파일 없음"}),p(a),g(i)}if(t.length>0&&S(t[0].entity_value||""),s.length>0){const a=s[0];_(a.entity_value||null),w(a.entity_value||"선택된 파일 없음")}}catch(n){console.error("데이터 로드 실패:",n)}},[]);r.useEffect(()=>{E()},[E]);const T=(n,t)=>{var a;const s=(a=t.target.files)==null?void 0:a[0];s&&(p(i=>({...i,[n]:s})),g(i=>({...i,[n]:s.name})))},W=n=>{var s;const t=(s=n.target.files)==null?void 0:s[0];t&&(_(t),w(t.name))},H=async()=>{const n=[],t={};try{const s=Object.entries(h).filter(([a,i])=>i instanceof File).map(async([a,i])=>{const d=new FormData;d.append("file",i);const m=await u.addAttachment(d);m.filename&&(t[Number(a)]=`${L.serverUrl}/${m.path.replace(/\\/g,"/")}`)});await Promise.all(s),b.forEach((a,i)=>{n.push({...a,entity_value:t[i+1]||a.entity_value})})}catch(s){console.error("파일 업로드 에러:",s),alert("파일 업로드에 실패했습니다.");return}if(n.push({...R[0],entity_value:C}),l&&l instanceof File){const s=new FormData;s.append("file",l);try{const a=await u.addAttachment(s);a.filename&&n.push({...c[0],entity_value:`${L.serverUrl}/${a.path.replace(/\\/g,"/")}`})}catch(a){console.error("비디오 파일 업로드 에러:",a);return}}else n.push({...c[0],entity_value:c[0].entity_value});try{await u.updateRows(n)?(y.success("설정이 성공적으로 저장되었습니다."),k.push("/settings")):y.error("저장에 실패했습니다.")}catch{y.error("저장 중 오류가 발생했습니다.")}},U=["메인페이지 PC 이미지","메인페이지 모바일 이미지","회원가입 소개 이미지"];return e.jsx("form",{children:e.jsxs(o,{spacing:3,sx:{mt:3,mx:"auto",maxWidth:{xs:720,xl:1200}},children:[e.jsxs(v,{children:[e.jsx(F,{title:"이미지 설정"}),e.jsx(f,{}),e.jsx(o,{spacing:3,sx:{p:3},children:b.map((n,t)=>e.jsxs(x,{children:[e.jsx(j,{variant:"subtitle2",sx:{mb:2},children:U[t]}),e.jsx("input",{type:"file",id:`file${t+1}`,style:{display:"none"},onChange:s=>T(t+1,s)}),e.jsxs(o,{direction:"row",spacing:2,alignItems:"center",sx:{mb:2},children:[e.jsx(D,{variant:"contained",component:"label",htmlFor:`file${t+1}`,children:"파일 선택"}),e.jsx(O,{onClick:()=>{const s=document.getElementById(`file${t+1}`);s&&(s.value=""),p(a=>({...a,[t+1]:null})),g(a=>({...a,[t+1]:"선택된 파일 없음"}))},children:e.jsx(M,{icon:"mdi:delete"})})]}),h[t+1]?e.jsx(x,{sx:{mb:2},children:e.jsx("img",{src:URL.createObjectURL(h[t+1]),alt:`배너 ${t+1}`,style:{maxWidth:"200px",maxHeight:"200px"}})}):e.jsx("img",{src:n.entity_value||V[t+1],alt:`배너 ${t+1}`,style:{maxWidth:"200px",maxHeight:"200px"}})]},t))})]}),e.jsxs(v,{children:[e.jsx(F,{title:"환율설정"}),e.jsx(f,{}),e.jsx(o,{spacing:3,sx:{p:3},children:e.jsx(J,{label:"환율",value:C,onChange:n=>S(n.target.value),fullWidth:!0})})]}),e.jsxs(v,{children:[e.jsx(F,{title:"메인페이지 영상"}),e.jsx(f,{}),e.jsxs(o,{spacing:3,sx:{p:3},children:[e.jsx(j,{variant:"subtitle2",children:"동영상 파일"}),e.jsx("input",{type:"file",id:"videoFile",style:{display:"none"},onChange:W}),l?e.jsx(x,{sx:{mb:2},children:e.jsx("video",{controls:!0,src:l instanceof File?URL.createObjectURL(l):l,style:{maxWidth:"400px",maxHeight:"400px"},children:e.jsx("track",{default:!0,kind:"captions",srcLang:"en"})})}):c[0]&&c[0].entity_value?e.jsx(x,{sx:{mb:2},children:e.jsx("video",{controls:!0,src:c[0].entity_value,style:{maxWidth:"400px",maxHeight:"400px"},children:e.jsx("track",{default:!0,kind:"captions",srcLang:"en"})})}):e.jsx(j,{children:I}),e.jsx(o,{direction:"row",spacing:2,alignItems:"center",children:e.jsx(D,{variant:"contained",component:"label",htmlFor:"videoFile",children:"파일 선택"})})]})]}),e.jsx(o,{alignItems:"flex-end",sx:{mt:3},children:e.jsx(Z,{type:"button",variant:"contained",size:"large",onClick:H,children:"수정 완료"})})]})})}function K(){return z("info"),e.jsxs(A,{children:[e.jsx(G,{heading:"사이트정보 관리",links:[{name:"Home",href:"/"},{name:"사이트정보 관리"}],sx:{mb:{xs:3,md:5}}}),e.jsx(q,{})]})}function le(){return e.jsx(e.Fragment,{children:e.jsx(K,{})})}export{le as default};
