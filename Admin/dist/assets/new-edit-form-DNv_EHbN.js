import{cA as c,R as p,ah as G,r as x,bi as _,Y as B,D as a,V as y,a6 as H,F as u,T as L,W as V,ak as Z,Z as X}from"./index-DJm73Gd8.js";import{z as r}from"./index-DXqQCM1T.js";import{t as Y,F as J}from"./form-provider-Bv2QLm_X.js";import{u as K,F as w,C as U}from"./fields-DRFNYTBH.js";import"./ko-DBbRYMOz.js";import"./image-DPed605N.js";import{A as l}from"./AuthService-foVeZrRB.js";import{C as q}from"./Card-DCic7xzO.js";import{C as Q}from"./CardHeader-qrX2o-AK.js";import{T as z}from"./TextField-B_joUv90.js";import{L as N}from"./LoadingButton-8OnUjDzw.js";const v={async getAllList(){try{return(await c.get(`${p.serverUrl}/manage/popup/list/all`,{headers:{Authorization:`Bearer ${l.getToken()}`}})).data}catch{l.clearLocalCredential(),window.location.replace("/");return}},async getList(e){try{return(await c.get(`${p.serverUrl}/manage/popup/list?page=${e.toString()}`,{headers:{Authorization:`Bearer ${l.getToken()}`}})).data}catch{l.clearLocalCredential(),window.location.replace("/");return}},async get(e){try{return(await c.get(`${p.serverUrl}/manage/popup/get?id=${e.toString()}`,{headers:{Authorization:`Bearer ${l.getToken()}`}})).data}catch{l.clearLocalCredential(),window.location.replace("/");return}},async create(e){try{return(await c.post(`${p.serverUrl}/manage/popup/create`,{popup:e},{headers:{Authorization:`Bearer ${l.getToken()}`}})).data}catch{return}},async update(e){try{return(await c.put(`${p.serverUrl}/manage/popup/update`,{popup:e},{headers:{Authorization:`Bearer ${l.getToken()}`}})).data}catch{return}},async updateProfile(e,s,f,$,m){try{return(await c.put(`${p.serverUrl}/manage/popup/updateProfile`,{id:e,nickName:s,cellPhone:f},{headers:{Authorization:`Bearer ${l.getToken()}`}})).data}catch{l.clearLocalCredential(),window.location.replace("/");return}},async delete(e){try{return(await c.delete(`${p.serverUrl}/manage/popup/delete?id=${e}`,{headers:{Authorization:`Bearer ${l.getToken()}`}})).data}catch{l.clearLocalCredential(),window.location.replace("/");return}},async addAttachment(e){try{return(await c.post(`${p.serverUrl}/upload/data/popup`,e,{headers:{Authorization:`Bearer ${l.getToken()}`,"Content-Type":"multipart/form-data"}})).data}catch(s){console.error(s);return}},async deleteAttachment(e){try{return(await c.delete(`${p.serverUrl}/upload/image?filename=${e}`,{headers:{Authorization:`Bearer ${l.getToken()}`}})).data}catch{l.clearLocalCredential(),window.location.replace("/");return}}},E=r.object({name:r.string().min(2,{message:"팝업명을 입력해 주세요"}),content:r.string().optional(),button_label:r.string().optional(),link_url:r.string().optional(),image_file:r.string().optional(),start_date:r.preprocess(e=>typeof e=="string"?e.trim()===""?null:new Date(e):e,r.date().nullable()),end_date:r.preprocess(e=>typeof e=="string"?e.trim()===""?null:new Date(e):e,r.date().nullable()),is_active:r.string().min(1),is_deleted:r.string().min(1),created_date:r.date()}),I=E.extend({id:r.number()});function he({currentItem:e}){var T;const s=G(),f=x.useMemo(()=>({id:(e==null?void 0:e.id)||0,name:(e==null?void 0:e.name)||"",content:(e==null?void 0:e.content)||"",button_label:(e==null?void 0:e.button_label)||"",link_url:(e==null?void 0:e.link_url)||"",image_file:(e==null?void 0:e.image_file)||"",start_date:e!=null&&e.start_date?new Date(e.start_date):null,end_date:e!=null&&e.end_date?new Date(e.end_date):null,is_active:(e==null?void 0:e.is_active)||"N",is_deleted:(e==null?void 0:e.is_deleted)||"N",created_date:e!=null&&e.created_date?new Date(e.created_date):new Date}),[e]),$=x.useMemo(()=>e?I:E,[e]),m=K({mode:"onSubmit",resolver:Y($),defaultValues:f}),{setValue:D,reset:j,watch:R,control:S,handleSubmit:M,formState:{isSubmitting:ee}}=m;x.useEffect(()=>{e&&j(f)},[e,f,j]),R();const[d,b]=x.useState({1:null,2:null});x.useEffect(()=>{e&&b({1:e.image_file||null})},[e]);const[P,C]=x.useState({1:"선택된 파일 없음",2:"선택된 파일 없음"}),W=async(t,i)=>{var n;const o=(n=i.target.files)==null?void 0:n[0];if(o){if(o.size>5242880){alert("파일 크기는 5MB 이하여야 합니다.");return}b(g=>({...g,[t]:o})),C(g=>({...g,[t]:o.name}))}},O=M(async t=>{try{const i={};try{const n=Object.entries(d).filter(([h,g])=>g instanceof File).map(async([h,g])=>{const k=new FormData;k.append("file",g);const A=await v.addAttachment(k);A.filename&&(i[Number(h)]=`${p.serverUrl}/${A.path.replace(/\\/g,"/")}`)});await Promise.all(n),t.image_file=i[1]||(typeof d[1]=="string"?d[1]:"")}catch(n){console.error("파일 업로드 에러:",n),alert("파일 업로드에 실패했습니다.");return}const o={...t,start_date:t.start_date?t.start_date instanceof Date?t.start_date:new Date(t.start_date):null,end_date:t.end_date?t.end_date instanceof Date?t.end_date:new Date(t.end_date):null,id:(e==null?void 0:e.id)||void 0,is_deleted:t.is_deleted||"N",created_date:t.created_date||new Date};e?await v.update(o)==="success"?(_.success("팝업 정보가 수정되었습니다."),s.push(B.popup.list)):_.error("팝업 수정에 실패했습니다."):await v.create(o)?(_.success("팝업 정보가 등록되었습니다."),s.push(B.popup.list)):_.error("팝업 등록에 실패했습니다."),j()}catch(i){console.error("오류 발생:",i),_.error("오류가 발생했습니다. 다시 시도해주세요.")}}),F=t=>{const i=t.getFullYear(),o=String(t.getMonth()+1).padStart(2,"0"),n=String(t.getDate()).padStart(2,"0");return`${i}-${o}-${n}`};return a.jsx(J,{methods:m,onSubmit:O,children:a.jsxs(y,{spacing:{xs:3,md:5},sx:{mt:3,mx:"auto",maxWidth:{xs:720,xl:1200}},children:[a.jsxs(q,{children:[a.jsx(Q,{title:"기본 정보",subheader:"",sx:{mb:1}}),a.jsx(H,{}),a.jsx(y,{spacing:3,sx:{p:3},children:a.jsxs(u,{rowGap:3,columnGap:2,display:"grid",gridTemplateColumns:{xs:"repeat(1, 1fr)",sm:"repeat(2, 1fr)"},children:[a.jsx(w.Text,{name:"name",label:"팝업 타이틀"}),a.jsx(w.Text,{name:"content",multiline:!0,rows:5,label:"팝업 내용",sx:{gridColumn:"1 / -1","& .MuiInputBase-root":{overflow:"hidden"}}}),a.jsx(U,{name:"start_date",control:S,render:({field:{value:t,onChange:i,...o}})=>a.jsx(z,{type:"date",label:"시작일",value:t?F(new Date(t)):"",onChange:n=>{const h=n.target.value?new Date(n.target.value):null;i(h)},...o})}),a.jsx(U,{name:"end_date",control:S,render:({field:{value:t,onChange:i,...o}})=>a.jsx(z,{type:"date",label:"종료일",value:t?F(new Date(t)):"",onChange:n=>{const h=n.target.value?new Date(n.target.value):null;i(h)},...o})}),a.jsx(w.Text,{name:"button_label",label:"버튼 텍스트"}),a.jsx(w.Text,{name:"link_url",label:"버튼 링크"}),a.jsxs(u,{sx:{pl:"14px"},children:[a.jsx(L,{variant:"subtitle2",children:"썸네일"}),a.jsx("br",{}),a.jsxs(u,{children:[a.jsx("input",{type:"file",id:"file1",style:{display:"none"},onChange:t=>{var o;((o=t.target.files)==null?void 0:o[0])&&W(1,t)}},d[1]?"hasFile":"noFile"),typeof d[1]=="string"?a.jsx(u,{sx:{mb:2},children:a.jsx("img",{src:d[1],alt:"이미지",style:{maxWidth:"200px",maxHeight:"200px"}})}):d[1]?(T=d[1])!=null&&T.type.startsWith("image/")?a.jsx(u,{sx:{mb:2},children:a.jsx("img",{src:URL.createObjectURL(d[1]),alt:"이미지",style:{maxWidth:"200px",maxHeight:"200px"}})}):a.jsx(u,{sx:{mb:2},children:a.jsxs("a",{href:URL.createObjectURL(d[1]),download:!0,children:["다운로드 [",d[1].name,"]"]})}):null,a.jsxs(y,{spacing:2,direction:"row",alignItems:"center",children:[a.jsx(V,{variant:"contained",component:"label",htmlFor:"file1",children:"파일 선택"}),a.jsx(L,{sx:{flex:1},children:P[1]}),d[1]&&a.jsx(Z,{onClick:()=>{const t=document.getElementById("file1");t&&(t.value=""),b(i=>({...i,1:null})),C(i=>({...i,1:"선택된 파일 없음"}))},children:a.jsx(X,{icon:"mdi:delete"})})]})]})]}),a.jsx(w.Text,{name:"created_date",label:"생성일",value:e!=null&&e.created_date?new Date(e.created_date).toLocaleDateString("ko-KR",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}):"",disabled:!0})]})})]}),a.jsxs(y,{direction:"row",alignItems:"flex-end",justifyContent:"flex-end",sx:{mt:3,gap:"10px"},children:[a.jsx(N,{color:"inherit",size:"large",variant:"outlined",onClick:()=>s.back(),children:"목록으로"}),a.jsx(N,{type:"submit",variant:"contained",size:"large",children:e?"수정 완료":"등록 완료"})]})]})})}export{he as N,v as P};
